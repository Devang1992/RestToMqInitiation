bash -c 'CURL_OUTPUT=$(curl -k -s -D -X POST "https://localhost:8080/jobs/launch/offset=$PARTS_OFFSET&partition=$PARTITION"); RES=$(echo "$CURL_OUTPUT" | head -n -1); BODY=$(echo "$CURL_OUTPUT" | tail -1 | tr -d "\r\n"); JOB_ID="$BODY"; OFFSET=$(echo "$RES" | tr '[:upper:]' '[:lower:]' | grep "last-offset" | sed "s/.last-offset:[[:space:]]\([^]]\)./\1/" | tr -d '[:space:]'); if [ -z "$JOB_ID" ]; then echo "ERROR: missing JOB_ID"; exit 1; fi; if [ -z "$OFFSET" ]; then echo "ERROR: Missing Last-Offset"; exit 1; fi; sendevent SET_GLOBAL=$PARTS_OFFSET=$OFFSET; STATUS="RUNNING"; COUNT=0; echo "JOB_ID=$JOB_ID"; echo "OFFSET=$OFFSET"; while [ "$STATUS" != "COMPLETED" ] && [ "$COUNT" -lt 60 ]; do sleep 15; STATUS=$(curl -k -s "https://localhost:8080/jobs/executions/$JOB_ID" | grep -i "STATUS" | sed "s/.STATUS=\([^]]\).*/\1/"); if [ "$STATUS" = "RUNNING" ]; then :; fi; COUNT=$((COUNT + 1)); done; if [ "$STATUS" != "COMPLETED" ]; then echo "$JOB_ID failed $STATUS"; exit 1; else echo "$JOB_ID successful"; exit 0; fi;'

bash -c 'CURL_OUTPUT=$(curl -k -s -D -X POST "https://localhost:8080/jobs/launch/offset=$PARTS_OFFSET&partition=$PARTITION"); RES=$(echo "$CURL_OUTPUT" | head -n -1); BODY=$(echo "$CURL_OUTPUT" | tail -1 | tr -d "\r\n"); JOB_ID="$BODY"; OFFSET=$(echo "$RES" | grep -i "Last-Offset" | sed "s/.Last-Offset:\([^]]\)./\1/"); if [ -z "$JOB_ID" ]; then echo "ERROR: missing JOB_ID"; exit 1; fi; if [ -z "$OFFSET" ]; then echo "ERROR: Missing Last-Offset"; exit 1; fi; sendevent SET_GLOBAL=$PARTS_OFFSET=$OFFSET; STATUS="RUNNING"; COUNT=0; echo "JOB_ID=$JOB_ID"; echo "OFFSET=$OFFSET"; while [ "$STATUS" != "COMPLETED" ] && [ "$COUNT" -lt 60 ]; do sleep 15; STATUS=$(curl -k -s "https://localhost:8080/jobs/executions/$JOB_ID" | grep -i "STATUS" | sed "s/.*STATUS=\([^]]\).*/\1/"); if [ "$STATUS" = "RUNNING" ]; then :; fi; COUNT=$((COUNT + 1)); done; if [ "$STATUS" != "COMPLETED" ]; then echo "$JOB_ID failed $STATUS"; exit 1; else echo "$JOB_ID successful"; exit 0; fi;'
