Run the following command once to initialize the KRaft metadata:

bash
Copy
Edit
docker run --rm \
  -e KAFKA_KRAFT_CLUSTER_ID=abcdefghij1234567890 \
  bitnami/kafka:3.4.0 \
  kafka-storage.sh format --cluster-id abcdefghij1234567890 --ignore-formatted
Explanation:

This tells Kafka to prepare its internal metadata storage (no ZooKeeper involved).

--ignore-formatted avoids error if you rerun it by mistake.

üîÅ Then: Start Your Kafka Container Again
bash
Copy
Edit
docker run --name kafka-kraft \
  -e ALLOW_PLAINTEXT_LISTENER=yes \
  -e KAFKA_CFG_PROCESS_ROLES=broker,controller \
  -e KAFKA_CFG_NODE_ID=1 \
  -e KAFKA_CFG_CONTROLLER_QUORUM_VOTERS=1@localhost:9093 \
  -e KAFKA_CFG_LISTENERS=PLAINTEXT://:9092,CONTROLLER://:9093 \
  -e KAFKA_CFG_ADVERTISED_LISTENERS=PLAINTEXT://localhost:9092 \
  -e KAFKA_KRAFT_CLUSTER_ID=abcdefghij1234567890 \
  -p 9092:9092 -p 9093:9093 \
  bitnami/kafka:3.4.0
You should now see logs indicating successful broker startup.

üß™ Bonus: Test That It‚Äôs Running
bash
Copy
Edit
docker exec -it kafka-kraft \
  kafka-topics.sh --bootstrap-server localhost:9092 --list
If this lists no topics (but runs), you're good.

If it's still exiting:

Run this: docker logs kafka-kraft | tail -n 50

Share that here so I can help debug exactly where it's failing.

You're almost there ‚Äî we just need this one-time setup right.


docker run -d --name kafka-kraft \
  -e KAFKA_CFG_PROCESS_ROLES=broker,controller \
  -e KAFKA_CFG_NODE_ID=1 \



  -e KAFKA_CFG_CONTROLLER_QUORUM_VOTERS=1@kafka-kraft:9093 \
  -e KAFKA_CFG_LISTENERS=PLAINTEXT://:9092,CONTROLLER://:9093 \
  -e KAFKA_CFG_ADVERTISED_LISTENERS=PLAINTEXT://localhost:9092 \
  -e KAFKA_KRAFT_CLUSTER_ID=abcdefghij1234567890 \
  -p 9092:9092 \
  bitnami/kafka:3.4.0


docker exec -it kafka-kraft kafka-topics.sh \
  --bootstrap-server localhost:9092 \
  --create --topic test-topic --partitions 1 --replication-factor 1


docker run -d --name kafka-kraft \
  -e KAFKA_CFG_PROCESS_ROLES=broker,controller \
  -e KAFKA_CFG_NODE_ID=1 \
  -e KAFKA_CFG_CONTROLLER_QUORUM_VOTERS=1@localhost:9093 \
  -e KAFKA_CFG_LISTENERS=PLAINTEXT://:9092,CONTROLLER://:9093 \
  -e KAFKA_CFG_ADVERTISED_LISTENERS=PLAINTEXT://localhost:9092 \
  -e KAFKA_KRAFT_CLUSTER_ID=abcdefghij1234567890 \
  -p 9092:9092 \
  bitnami/kafka:latest


‚úÖ Here's how to run Kafka + Zookeeper locally without Docker Compose:
Since you already have the bitnami/kafka image, let‚Äôs go step-by-step:

üîπ 1. Pull & Run Zookeeper
If you haven‚Äôt pulled it:

bash
Copy
Edit
docker pull bitnami/zookeeper:latest
Run Zookeeper:

bash
Copy
Edit
docker run -d --name zookeeper \
  -e ALLOW_ANONYMOUS_LOGIN=yes \
  -p 2181:2181 \
  bitnami/zookeeper:latest
üîπ 2. Run Kafka and Link it to Zookeeper
Assuming you've already pulled bitnami/kafka:

bash
Copy
Edit
docker run -d --name kafka \
  --link zookeeper:zookeeper \
  -e KAFKA_BROKER_ID=1 \
  -e KAFKA_CFG_ZOOKEEPER_CONNECT=zookeeper:2181 \
  -e KAFKA_CFG_LISTENERS=PLAINTEXT://:9092 \
  -e KAFKA_CFG_ADVERTISED_LISTENERS=PLAINTEXT://localhost:9092 \
  -e ALLOW_PLAINTEXT_LISTENER=yes \
  -p 9092:9092 \
  bitnami/kafka:latest
‚úÖ Now Kafka should be running
Kafka is now listening on port 9092

Zookeeper is running on port 2181

Your Spring Boot app can connect to localhost:9092

üîç Check Containers:
bash
Copy
Edit
docker ps
üß™ Test Kafka (Optional)
Produce a test message:

bash
Copy
Edit
docker exec -it kafka kafka-console-producer.sh \
  --broker-list localhost:9092 --topic test-topic
Consume it:

bash
Copy
Edit
docker exec -it kafka kafka-console-consumer.sh \
  --bootstrap-server localhost:9092 --topic test-topic --from-beginning
